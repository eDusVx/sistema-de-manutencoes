<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Static Navigation - SB Admin</title>
    <link href="css/styles.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <a class="navbar-brand ps-3" href="index.html">My.cars</a>
        <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i class="fas fa-bars"></i></button>
        <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
            <div class="input-group"></div>
        </form>
        <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                    <li><a class="dropdown-item" href="#!">Sair</a></li>
                </ul>
            </li>
        </ul>
    </nav>
    <div id="layoutSidenav">
        <!-- Substitua a barra lateral existente com a seção atualizada -->
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <a class="nav-link" href="index.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Página Inicial
                        </a>
                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapseLayouts" aria-expanded="false" aria-controls="collapseLayouts">
                            <div class="sb-nav-link-icon"><i class="fas fa-columns"></i></div>
                            Gerenciar Veículos
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseLayouts" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="layout-static.html">Cadastrar Veículos</a>
                                <a class="nav-link" href="layout-sidenav-light.html">Meus Veículos</a>
                            </nav>
                        </div>
                        <a class="nav-link" href="charts.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-chart-area"></i></div>
                            Gráfico
                        </a>
                        <a class="nav-link" href="tables.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-table"></i></div>
                            Ranking
                        </a>
                    </div>
                </div>
                <!-- Add an id attribute to the element where you want to display the logged-in user's name -->
                <div class="sb-sidenav-footer" id="loggedInUser">
                    <div class="small">Usuário:</div>
                    <!-- The user's name will be displayed here -->
                </div>
            </nav>
        </div>
        <!-- Fim da substituição da barra lateral -->
        <div id="layoutSidenav_content">
            <main>
                <div class="container-fluid px-4">
                    <h1 class="mt-4">Ranking</h1>
                    <div class="table-responsive">
                        <!-- Table to display car information -->
                        <table class="table table-bordered table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">Marca</th>
                                    <th scope="col">Modelo</th>
                                    <th scope="col">Manutenções</th>
                                </tr>
                            </thead>
                            <tbody id="carTableBody">
                                <!-- Table rows will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
            <footer class="py-4 bg-light mt-auto">
                <div class="container-fluid px-4">
                    <div class="d-flex align-items-center justify-content-between small">
                        <div class="text-muted">Copyright &copy; Your Website 2023</div>
                        <div>
                            <a href="#">Privacy Policy</a>
                            &middot;
                            <a href="#">Terms &amp; Conditions</a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="js/scripts.js"></script>

    <!-- <script>
        document.addEventListener('DOMContentLoaded', function () {
            const data = [
                {
                    "id": "9098952c-b21b-471b-893f-ccf06ae42a1b",
                    "marca": "Audi",
                    "modelo": "A5",
                    "ano": "2018",
                    "usuario": {
                        "id": "05585299174",
                        "nome": "Eduardo Silva Xavier",
                        "email": "eduardosvx@gmail.com",
                        "senha": "123"
                    },
                    "manutencoes": [
                        {
                            "id": "c54adb16-56af-4bae-a285-99ae4e89ef58",
                            "problema": "problema",
                            "data": "2023-11-17 22:28:15-03:00",
                            "solucao": {
                                "id": "fe2758bc-6f03-461d-9701-72306f3c4f56",
                                "descricao": "resolvido o problema",
                                "gastos": 129.99
                            }
                        },
                        {
                            "id": "f0a78ab4-d5e8-4c2f-9bae-dfeffe6c7442",
                            "problema": "problema",
                            "data": "2023-11-17 22:28:06-03:00",
                            "solucao": {
                                "id": "bbc93cdf-848b-48f9-9aed-6130355632e6",
                                "descricao": "resolvido o problema",
                                "gastos": 129.99
                            }
                        }
                    ]
                },
                {
                    "id": "76de2bb4-5f23-411e-b957-e96febe82093",
                    "marca": "Audi",
                    "modelo": "A5",
                    "ano": "1997",
                    "usuario": {
                        "id": "1",
                        "nome": "parelo",
                        "email": "parelo.verdebananao@gmail.com",
                        "senha": "12345"
                    },
                    "manutencoes": []
                }
            ];

            // Group cars by model and brand and calculate the number of maintenances
            const groupedCars = {};
            data.forEach(car => {
                const key = `${car.marca}-${car.modelo}`;
                if (!groupedCars[key]) {
                    groupedCars[key] = { ...car, manutencoes: car.manutencoes.length };
                } else {
                    groupedCars[key].manutencoes += car.manutencoes.length;
                }
            });

            // Reference to the car table body
            const carTableBody = document.getElementById('carTableBody');

            // Populate the table with car data
            Object.values(groupedCars).forEach(car => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${car.modelo}</td>
                    <td>${car.marca}</td>               
                    <td>${car.manutencoes}</td>
                `;
                carTableBody.appendChild(row);
            });

            // ... rest of your existing code
        });
    </script> -->
</body>
</html>


<script>
    document.addEventListener('DOMContentLoaded', async function () {
        const token = localStorage.getItem('token');

        if (!token) {
            // Redirect to the login page if the token is not present
            window.location.href = 'login.html'; // Substitua 'login.html' pela URL real da sua página de login
        }

        const id = localStorage.getItem('id');
        console.log(id);
        const nome = localStorage.getItem('nome');
        console.log(nome);

        // Atualize o elemento 'loggedInUser' com o nome do usuário
        const loggedInUserElement = document.getElementById('loggedInUser');
        loggedInUserElement.textContent = `Logado como: ${nome}`;

        const carTableBody = document.getElementById('carTableBody');

        // Logout functionality
        const logoutLink = document.querySelector('.dropdown-item');

        logoutLink.addEventListener('click', function (event) {
            // Evite o comportamento padrão do link
            event.preventDefault();

            // Limpe o localStorage
            localStorage.removeItem('id');
            localStorage.removeItem('token');
            localStorage.removeItem('nome');

            // Redirecione para a página de login
            window.location.href = 'login.html'; // Substitua 'login.html' pela URL real da sua página de login
        });

        try {
            // Faça a solicitação HTTP GET para a rota do backend
            const response = await axios.get('http://localhost:3000/core/buscar-carro');
            const data = response.data;

            // Group cars by model and brand and calculate the number of maintenances
            const groupedCars = {};
            data.forEach(car => {
                const key = `${car.marca}-${car.modelo}`;
                if (!groupedCars[key]) {
                    groupedCars[key] = { ...car, manutencoes: car.manutencoes.length };
                } else {
                    groupedCars[key].manutencoes += car.manutencoes.length;
                }
            });

            // Limpe as linhas existentes na tabela
            carTableBody.innerHTML = '';

            // Popule a tabela com os dados agrupados
            Object.values(groupedCars).forEach(car => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${car.modelo}</td>
                    <td>${car.marca}</td>
                    <td>${car.manutencoes}</td>
                `;
                carTableBody.appendChild(row);
            });
        } catch (error) {
            console.error('Erro ao obter dados do servidor:', error);
            // Trate o erro conforme necessário
        }
    });
</script>

<style>
    /* Adicione este trecho ao seu arquivo CSS ou ao estilo embutido no cabeçalho do HTML */
    .table-responsive {
        margin-top: 20px;
    }

    .table th, .table td {
        text-align: center;
    }

    .table thead th {
        vertical-align: middle;
    }

    .table tbody tr:hover {
        background-color: #f5f5f5;
    }
</style>